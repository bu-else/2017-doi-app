# Heroku
The backend of the API is set up on Heroku. The source code is hosted on [2017-doi-server](https://github.com/bu-else/2017-doi-server). To make changes, the repository must be cloned to your computer. The app is currently hosted on Ben's free Heroku account,  so to modify it you will have to get permissions. I am unsure if it is even possible to have multiple collaborators on a free Heroku account. If I can hand it over, the proccess of pushing is very easy, you just do a normal commit by adding to the staging and then commit, but then you must use the command:
```
git push heroku master
```
which restarts the server. It will ask you to login to Heroku if you have not already.The steps for starting a new Heroku server are pretty well explained by the [Node.js Heroku Tutorial](https://devcenter.heroku.com/articles/getting-started-with-nodejs). If you want to change the name, you must change the proxy used by the client in:
```
ionic.config.json
```
and also you must point the webhook for the Twilio account's SMS reciever at the new URL. This can be done under the [Twilio Manage Numbers page](https://www.twilio.com/console/phone-numbers/). Finally, the environment variables set up on the server are crucial to its running and they can be seen by running:
```
heroku config
```
while in the 2017-doi-server folder. They are pretty self explanatory, but if you get a new Twilio phone number you will wantto change TWILIO_NUM and once you have the dispatcher's real number you will want to change DISPATCH_NUMBER.Note that the DISPATCH_NUMBER is currently set to Ben's phone number, and anytime you test this app it sendsBen the text messages as if he were the dispatcher, so please be considerate :).


# Twilio
Currently, we are using the trial version of Twilio. It worked well during the semester, as it allows unlimited messages.However, it can only send to Ben and Michael's numbers. You will want to upgrade it. As noted in the issues, Ben pushedthe Twilio number onto this repository and it stayed there for like months, so you [might want to replace it](https://github.com/bu-else/2017-doi-app/issues/54). It doesn't seem compromised and it doesn't really matter if it gets a lot of texts, [but it might be a good idea to get a new one](https://www.twilio.com/pricing). If you do so, you have to set up its webhookhandler as noted above.


# Google Maps
Also you should get a new [Google Maps Geolocation API key](https://developers.google.com/maps/documentation/geolocation/intro) and replace MAPS_KEY in the Heroku environment variables.

# Registration
Currently, the registration flow is still a WIP. The backend uses [Frame](https://github.com/jedireza/frame) hosted on MongoDB. It works only on local host for now, but will be merged with the Heroku. It is currently contained in theFrame folder in this repository, but should [merged to into the 2017-doi-server](https://github.com/bu-else/2017-doi-app/issues/69).


# Client
First, you will want to clone this repository onto your computer. Then you will need the 2 environment variables fileswe have set up. There is currently one in the Frame folder, but those will soon be Heroku environment variables. The other environmental variable file is:
```
client\src\env.ts
```
which either Ben or Michael can send you. You can also find it our Slack channel!


# API
I have the following URLs with their annotations in a note on my computer, so that it is easy to test the API of the backend. I removed my phone number, lat-long, address and zipcode but you will have to insert valid test data.It is important the the emergencyID generated by the backend is only sent to the dispatcher and never returned during an API call. It isn't a matter of intense security, as one could theoretically bruteforce the map, but if you have the 4-digit emergencyID you can access the location of the caller. If you test it, remember that as stated above,it sends texts to Ben's mobile phone (with your location).

http://doi-server.herokuapp.com/latlng/?&deviceID=computer-id&From=YOUR_NUMBER&LatLng=YOUR-LAT,LNG
* Sends a sms to the emergency receiver with a new emergency ID generated
* Does not send the ID to the user, just a generic success

http://doi-server.herokuapp.com/address/?&deviceID=computer-id&Address=YOUR-ADDRESS&Zipcode=YOUR-ZIP
* Sends an sms to the emergency receiver with the updated information and the ID
* Does not send the ID to the user, just a generic success

http://doi-server.herokuapp.com/dispatch/?&deviceID=computer-id
* Awaits a response from the dispatcher

http://doi-server.herokuapp.com/fetch/?&deviceID=computer-id
* Returns the address to the user

http://doi-server.herokuapp.com/fetch/?&emergencyID=TEST
* As above but using emergencyID

http://doi-server.herokuapp.com/end/?&deviceID=computer-id
* Closes the emergency on the server, does not send sms to caller or dispatcher
* Returns generic success to whoever made the request.

http://doi-server.herokuapp.com/end/?&emergencyID=TEST
* As above but using emergencyID
 
